#!/usr/bin/env node

var path 	= require('path'),
	dir		= path.join(__dirname, '..'),
	program = require('commander'),
	_ 		= require('underscore'), 
	fns 	= require( path.join(dir, 'lib', 'fns.js' ) ),
	config 	= require( path.join(dir, 'lib', 'config.js' ) ),
	utils 	= require( path.join(dir, 'lib', 'utils.js' ) ),
	data 	= require( path.join(dir, 'package.json') );

program.name = data.name ;
program.version( data.version );

program
	.description( data.description )

	//Data Base put
	.option('-d, --db [db]', 'Name of db')
	.option('-h, --host [host]', 'IP for the mongoDB')
	.option('-p, --port [port]', 'Port for the mongoDB')
	.option('-u, --user [user]', 'Username for database' )
	.option('-w, --pass [pass]', 'Password for database' )
	.option('-m, --multi [multi]', 'Multiply servers mongo' )

	//Data Base get
	.option('-t, --http [http]', 'Url to download the CVS' )
	.option('-s, --splitter [splitter]', 'Divisor entre valores' )
	.parse(process.argv);

	//Acionar
database = !program.multi ? utils.url( {
		host : program.host || config.get('host'),
		port : program.port || config.get('port'),
		user : program.nick || false,
		pass : program.password || false,
		path : program.db || config.get('db'),
		type : config.get('type'),
	}) : program.multi;
fns.existAndDownload( utils.isUrl( program.url ), function (err, path) {
	if(err)
		uitls.console(err, path);
		fns.update(path, database, utils.orden( program.splitter ) , program.splitter || config.get('divisor'), function(err, doc){
			uitls.console(err, doc);
		});
	});
;